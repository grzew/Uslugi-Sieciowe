\documentclass{beamer}
\usepackage[utf8]{inputenc}
\usetheme{Warsaw}
\title[GlusterFS]{H-A Web \& Storage system with Automatic File Replication}
\author{Grzegorz Wieczorek}
\institute{Wydział Zastosowań Informatyki\\Szkoła Główna Gospodarstwa Wiejskiego}
\date{7 Czerwiec 2011}


\usepackage{graphicx}
\begin{document}

\begin{frame}
\titlepage
\end{frame}

\begin{frame}
	\tableofcontents
\end{frame}


\section{Wprowadzenie}
\begin{frame}
	\tableofcontents[currentsection,currentsubsection]
\end{frame}

\begin{frame}{Założenia}
	Co jak i dlaczego?
\end{frame}

\subsection{Topologia}
\begin{frame}
	\tableofcontents[currentsection,currentsubsection]
\end{frame}

\begin{frame}{Topologia}
	\begin{figure}[htp]
	\centering
	\includegraphics[scale=0.25]{Topologia1.png}
	\caption{Topologia}
	\label{}
	\end{figure}
\end{frame}

\section{LDAP}

\begin{frame}
	\tableofcontents[currentsection,currentsubsection]
\end{frame}

\section{Content - GlusterFS}
\begin{frame}
	\tableofcontents[currentsection,currentsubsection]
\end{frame}

\subsection{Server}
\begin{frame}
	\tableofcontents[currentsection,currentsubsection]
\end{frame}

\begin{frame}{Instalacja}
	\begin{block}{server1/server2}
	\# apt-get install glusterfs-server
	\end{block}
	Po wykonaniu powyższego polecenia zostanie zainstalowany serwer GlusterFS razem ze wszystkimi zależnościami niezbednymi do działania.
	\pause
	\begin{block}{Struktura katalogów}
	\# mkdir -p /data/export \\
	\# mkdir /data/export-ns
	\end{block}
\end{frame}

\begin{frame}
	\frametitle{Konfiguracja}
	\begin{exampleblock}{Przygotowanie}
	\# mv /etc/glusterfs/glusterfsd.vol\{,.old\} \\
	\# vim /etc/glusterfs/glusterfsd.vol
	\end{exampleblock}
	\pause
	\begin{semiverbatim}
	volume posix
	
	  type storage/posix
	  
	  option directory /data/export
	  
	end-volume
	
	
	volume locks
	
	  type features/locks
	  
	  subvolumes posix
	  
	end-volume
	\end{semiverbatim}
\end{frame}
\begin{frame}
	\begin{semiverbatim}
volume brick

  type performance/io-threads
  
  option thread-count 8
  
  subvolumes locks
  
end-volume


volume server

  type protocol/server
  
  option transport-type tcp
  
  option auth.addr.brick.allow 172.16.1.103
  
  subvolumes brick
  
end-volume
	\end{semiverbatim}
	\pause
	\begin{block}{Uruchomienie}
	\# /etc/init.d/glusterfs-server start
	\end{block}
\end{frame}

\subsection{Client}
\begin{frame}
	\tableofcontents[currentsection,currentsubsection]
\end{frame}

\begin{frame}{Instalacja}
	\begin{block}{client1}
	\# apt-get install glusterfs-client glusterfs-server
	\end{block}
	Po wykonaniu powyższego polecenia zostanie zainstalowany klient GlusterFS razem ze wszystkimi zależnościami niezbednymi do działania.
	\pause
	\begin{exampleblock}{Struktura Katalogów}
	\# mkdir /mnt/glusterfs
	\end{exampleblock}
\end{frame}

\begin{frame}{Konfiguracja}
	\begin{block}{Przygotowanie}
	\# mv /etc/glusterfs/glusterfs.vol\{,.old\} \\
	\# vim /etc/glusterfs/glusterfs.vol
	\end{block}
	\pause
	\begin{semiverbatim}
	volume remote1
	
	  type protocol/client
  
	  option transport-type tcp
	  
	  option remote-host server1.example.com
	  
	  option remote-subvolume brick
	  
	end-volume
	\end{semiverbatim}
\end{frame}
\begin{frame}
	\begin{semiverbatim}
	volume remote2
	
	  type protocol/client
	  
	  option transport-type tcp
	  
	  option remote-host server2.example.com
	  
	  option remote-subvolume brick
	  
	end-volume
	
	
	volume replicate
	
	  type cluster/replicate
	  
	  subvolumes remote1 remote2
	  
	end-volume
	\end{semiverbatim}
\end{frame}
\begin{frame}
	\begin{semiverbatim}
	volume writebehind
	
	  type performance/write-behind
	  
	  option window-size 1MB
	  
	  subvolumes replicate
	  
	end-volume


	volume cache
	
	  type performance/io-cache
	  
	  option cache-size 512MB
	  
	  subvolumes writebehind
	  
	end-volume
	\end{semiverbatim}
\end{frame}
\begin{frame}{Montowanie}
	\begin{exampleblock}{Metoda 1}
	\# glusterfs -f /etc/glusterfs/glusterfs.vol /mnt/glusterfs
	\end{exampleblock}
	\pause
	\begin{block}{Metoda 2}
	\# mount -t glusterfs /etc/glusterfs/glusterfs.vol /mnt/glusterfs
	\end{block}
	\pause
	\begin{alertblock}{fstab}
	\begin{semiverbatim}
	/etc/glusterfs/glusterfs.vol  /mnt/glusterfs  glusterfs  defaults  0  0
	\end{semiverbatim}
	\end{alertblock}
\end{frame}

\section{Apache}

\begin{frame}
	\tableofcontents[currentsection,currentsubsection]
\end{frame}

\subsection{Workers}
\begin{frame}
	\tableofcontents[currentsection,currentsubsection]
\end{frame}
\begin{frame}{Instalacja}
sudo apt-get install apache2
\end{frame}
\begin{frame}{vhost}
\begin{semiverbatim}
	RewriteEngine On
	
	RewriteRule .* - [CO=BALANCEID:balancer.worker1:.kropka.pl]
\end{semiverbatim}
\end{frame}

\subsection{Load Balancer}
\begin{frame}
	\tableofcontents[currentsection,currentsubsection]
\end{frame}
\begin{frame}{Instalacja}
sudo apt-get install apache2
\end{frame}
\begin{frame}{Konfiguracja}
a2enmod proxy

\pause

a2enmod proxy\_balancer

\pause

a2enmod proxy\_http

\pause

a2enmod status
\end{frame}
\begin{frame}
	\frametitle{vhost I}
	\begin{semiverbatim}
	serverName kropka.pl
	
	DocumentRoot /var/www
	
	ProxyRequests Off

        <Proxy *>
        
          Order deny,allow
          
          Allow from all
          
        </Proxy>
        \end{semiverbatim}
\end{frame}
\begin{frame}
	\frametitle{vhost II}
	\begin{semiverbatim}
        ProxyPass /balancer-manager !
        
        ProxyPass / balancer://mycluster/ stickysession=BALANCEID nofailover=On
        
        ProxyPassReverse / http://worker1.kropka.pl/
        
        ProxyPassReverse / http://worker2.kropka.pl/
        
        <Proxy balancer://mycluster>
        
          BalancerMember http://worker1.kropka.pl  route=worker1
          
          BalancerMember http://worker2.kropka.pl  route=worker2
          
          ProxySet lbmethod=byrequests
          
        </Proxy>
        \end{semiverbatim}
\end{frame}
\begin{frame}
	\frametitle{vhost III}
	\begin{semiverbatim}
        <Location /balancer-manager>
        
          SetHandler balancer-manager
          
          Order deny,allow
          
          Allow from all
          
        </Location>

	\end{semiverbatim}
\end{frame}

\section{VRRP}
\begin{frame}
	\tableofcontents[currentsection,currentsubsection]
\end{frame}
\begin{frame}{Konfiguracja}
vrrpd -i eth0 -v 50 -p 100 -n ADRES\_IP
\end{frame}
\section{Nagios}
\begin{frame}
	\tableofcontents[currentsection,currentsubsection]
\end{frame}

\section{Podsumowanie}
\begin{frame}
	\tableofcontents[currentsection,currentsubsection]
\end{frame}

\begin{frame}{Linki}
	http://www.gluster.org/
\end{frame}


\end{document}